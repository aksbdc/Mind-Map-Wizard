<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <meta
            name="description"
            content="Mind Map Wizard: Generate mind maps effortlessly by typing in a topic. Free, no sign-up, no ads.">
        <meta
            name="keywords"
            content="mind map, mind mapping, AI, text to mindmap, free mind map generator, no sign up, no ads">

        <meta property="og:title" content="Mind Map Wizard | Text to Mind Map AI">
        <meta
            property="og:description"
            content="Generate mind maps effortlessly by typing in a topic. Free, no sign-up, no ads.">
        <meta property="og:image" content="/img/meta-img.jpg">

        <meta property="og:type" content="website">

        <meta name="twitter:card" content="/img/meta-img.jpg">
        <meta name="twitter:title" content="Mind Map Wizard | Text to Mind Map AI">
        <meta
            name="twitter:description"
            content="Generate mind maps effortlessly by typing in a topic. Free, no sign-up, no ads.">
        <meta name="twitter:image" content="/img/meta-img.jpg">

        <link rel="icon" type="image/png" href="/img/favicon16.png" sizes="16x16">
        <link rel="icon" type="image/png" href="/img/favicon32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/img/favicon48.png" sizes="48x48">
        <link rel="icon" type="image/png" href="/img/favicon64.png" sizes="64x48">
        <link rel="icon" type="image/png" href="/img/favicon96.png" sizes="96x96">
        <link rel="apple-touch-icon" href="/img/logo.png">

        <meta name="theme-color" content="#C667FF">
        <meta name="language" content="en">

        <title>AI Mind Map Maker - Generate Mind Map | Mind Map Wizard</title>
        <link href="/OpenSans-ExtraBold.ttf" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5"></script>
        <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.16.1"></script>
        <script src="https://cdn.jsdelivr.net/npm/markmap-view@0.16.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.16"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <style>
            :root {
                --primary-color: #C667FF;
                --secondary-color: #9D34D4;
                --background-color: #F5F5F7;
                --text-color: #1e293b;
                --border-color: #e2e8f0;
                --error-color: #dc2626;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            .feedback-button {
                position: fixed;
                bottom: 20px;
                left: 20px;
                display: flex;
                align-items: center;
                background-color: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: 25px;
                padding: 10px;
                text-decoration: none;
                color: var(--text-color);
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
                z-index: 1000;
                width: 45px;
                overflow: hidden;
            }

            .feedback-button:hover {
                width: 130px;
            }

            .feedback-button img {
                width: 25px;
                height: 25px;
                margin-right: 10px;
            }

            .feedback-button span {
                white-space: nowrap;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .feedback-button:hover span {
                opacity: 1;
            }

            .info-button {
                position: fixed;
                bottom: 15px;
                right: 15px;
                display: flex;
                align-items: center;
                background-color: rgba(248, 250, 252, 0.9);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: 25px;
                padding: 10px;
                text-decoration: none;
                color: var(--text-color);
                transition: all 0.3s ease;
                z-index: 1000;
                cursor: pointer;
            }

            .info-menu {
                position: fixed;
                bottom: 70px;
                right: 20px;
                background-color: rgba(248, 250, 252, 0.9);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: 15px;
                padding: 10px;
                display: none;
                flex-direction: column;
                z-index: 1000;
            }

            .info-menu.show {
                display: flex;
            }

            .info-menu a {
                color: var(--text-color);
                text-decoration: none;
                padding: 8px 15px;
                border-radius: 8px;
                transition: background-color 0.3s ease;
                white-space: nowrap;
            }

            .info-menu a:hover {
                background-color: rgba(0, 0, 0, 0.05);
            }

            @font-face {
                font-family: 'Open Sans';
                src: url("/OpenSans-ExtraBold.ttf") format('truetype'), url("/OpenSans-ExtraBold.ttf") format('ttf');
                font-weight: 800;
                font-style: normal;
                font-display: swap;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                margin: 0;
                padding: 0;
                background: var(--background-color);
                color: var(--text-color);
                position: relative;
                overflow-x: hidden;
            }

            #mindmap {
                position: fixed;
                margin: 0;
                height: 100vh;

                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 1;
                background: #f8fafc;
            }

            #mindmap svg {
                width: 100% !important;
                height: 100% !important;
                display: block;
            }

            #mindmap svg path {
                stroke-opacity: 1 !important;
                fill-opacity: 1 !important;
            }

            #loading-animation {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 1000;
                display: none;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                font-size: 20px;
                background-color: #F8FAFC;
                border-radius: 10px;
                width: 100vw;
                height: 100vw;
            }

            .navbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0;
                background-color: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                height: 50px;
                z-index: 1000;
                box-sizing: border-box;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 0.8rem;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                display: flex;
                align-items: center;
                z-index: 1001;
            }

            .text-logo {
                display: flex !important;
                align-items: center !important;
                margin-left: 0;
            }

            .logo {
                margin-right: 10px;
                height: 40px;
                width: auto;
            }

            .logo-link {
                display: flex;
                align-items: center;
                text-decoration: none;
                color: inherit;
            }

            .logo-text {
                font-family: 'Open Sans', sans-serif;
                font-size: 1.8em;
                font-weight: 800;
                width: calc(100vw - 400px);
                color: var(--text-color);
                margin-left: 0;
                text-decoration: none !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            @media (max-width: 730px) {
                .logo-text {
                    display: none;
                }
            }

            @media (max-width: 400px) {
                .nav-links img {
                    display: none;
                }
            }

            .navbutton {
                background-color: var(--primary-color);
                padding: 3px;
                height: 40px;
                border: 2px solid var(--primary-color);
                padding-left: 8px;
                padding-right: 20px;
                border-radius: 6px;
                color: #fff !important;
                transition: background-color 0.3s ease, border 0.3s ease, color 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color 0.3s ease;
            }

            .navbutton:hover {
                background-color: var(--secondary-color);
                border: 2px solid var(--secondary-color);
            }

            @media (max-width: 520px) {
                .navbutton {
                    display: none;
                }
            }

            .nav-links {
                margin-left: auto;
                margin-right: 5px;
                display: flex;
                align-items: center;
            }

            .nav-links img {
                position: relative;
                top: 5px;
            }

            .nav-links a {
                margin-left: 0;
                margin-right: 10px;
                text-decoration: none;
                color: black;
                font-weight: 500;
                transition: color 0.3s ease;
                border-radius: 10px;
                padding: 5px 10px 10px;
            }

            .nav-links a:hover {
                background-color: rgba(0, 0, 0, 0.032);
                border-radius: 10px;
                padding: 5px 10px 10px;
            }

            #app {
                margin: 40px auto;
                padding: 0 20px;
                position: relative;
                z-index: 100;
                margin: 40px auto;
                padding: 0 20px;
                margin-top: 100px;

            }

            .header {
                position: relative;
                text-align: center;
                margin-bottom: 30px;
                z-index: 100;
                padding: 0;
                border-radius: 8px;
                backdrop-filter: blur(5px);
            }

            .header h1 {
                font-size: 2.5rem;
                color: var(--text-color);
                margin-bottom: 30px;
                line-height: 1.2;
            }

            @media (max-width: 750px) {
                .header h1 {
                    font-size: 2rem !important;
                    line-height: 1.3;
                    padding: 0 10px;
                    color: var(--text-color);
                }
            }

            /* From Uiverse.io by vinodjangid07 */
            .input-wrapper {
                width: 100%;
                max-width: 500px;
                height: 55px;
                border-radius: 40px;
                padding: 0;
                border: 2px solid var(--border-color);
                font-size: 1.1rem;
                resize: vertical;
                box-sizing: content-box;
                display: flex;
                align-items: center;
                background-color: #ffffff;
                transition: border-color 0.3s ease;
                position: relative;
                margin: 0 auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            }

            .input-wrapper:focus-within {
                outline: none;
                border-color: var(--primary-color);
            }

            .input {
                flex-grow: 1;
                height: 94%;
                border: none;
                outline: none;
                padding-left: 15px;
                background-color: #ffffff;
                color: black;
                font-size: 1.2rem;
                border-radius: 40px;
            }

            .input:-webkit-autofill {
                -webkit-box-shadow: 0 0 0 1000px #292524 inset;
                -webkit-text-fill-color: #ffffff;
            }

            .send-prompt-btn {
                height: 47px;
                width: 47px;
                background-color: #C667FF;
                border: none;
                border-radius: 40px;
                color: rgb(0, 0, 0);
                cursor: pointer;
                font-weight: 500;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                position: absolute;
                top: 4.5px;
                right: 5px;
                transition: all 0.3s;
            }

            .input-wrapper:active .icon {
                transform: scale(1.3);
            }

            .send-prompt-btn:hover {
                color: white;
            }

            .send-prompt-btn:hover .arrow {
                margin-right: 0;
                animation: jello-vertical 0.9s both;
                transform-origin: right;
            }

            @keyframes jello-vertical {
                0% {
                    transform: scale3d(1, 1, 1);
                }
                30% {
                    transform: scale3d(0.75, 1.25, 1);
                }
                40% {
                    transform: scale3d(1.25, 0.75, 1);
                }
                50% {
                    transform: scale3d(0.85, 1.15, 1);
                }
                65% {
                    transform: scale3d(1.05, 0.95, 1);
                }
                75% {
                    transform: scale3d(0.95, 1.05, 1);
                }
                100% {
                    transform: scale3d(1, 1, 1);
                }
            }
            .send-prompt-btn:active {
                transform: scale(0.9);
            }

            #back-button {
                position: fixed;
                left: 0;
                z-index: 100;
                top: 80px;
                background-color: rgba(255, 255, 255, 1);
                padding: 10px 10px 10px 20px;
                border-radius: 0 0 8px 0;
                backdrop-filter: blur(5px);

                margin: 20px auto;
                max-width: 600px;
                transform: translateY(-50px);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            }

            .back-button {
                color: var(--text-color);
                display: none;
            }

            .centered-div {
                justify-content: center;
                align-items: flex-start;
                height: auto;
            }

            .send-icon {
                margin: 3px;
            }

            .ai-content-disclaimer {
                position: fixed;
                bottom: 10px;
                left: 10px;
                z-index: 100;
                background-color: rgba(248, 250, 252, 0.9);
                padding: 5px 10px;
                border-radius: 20px;
                backdrop-filter: blur(5px);
                color: #333333;
                display: none;
            }

            /* From Uiverse.io by elijahgummer */
            .analyze svg path.stick {
                transform: translate(0);
                animation: stick 2s ease infinite;
            }

            .analyze svg path.star-1 {
                fill: #ff4500;
                animation: sparkles 2s ease infinite, scaleStars 2s ease infinite, colorChange 2s ease infinite;
                animation-delay: 150ms;
            }

            .analyze svg path.star-2 {
                fill: #0ff000;
                animation: sparkles 2s ease infinite, scaleStars 2s ease infinite, colorChange 2s ease infinite;
            }

            .board {
                animation: bounce 2s ease infinite;
            }

            @keyframes sparkles {
                0% {
                    opacity: 1;
                }
                35% {
                    opacity: 1;
                }
                55% {
                    opacity: 0;
                }
                75% {
                    opacity: 1;
                }
                100% {
                    opacity: 1;
                }
            }

            @keyframes stick {
                0% {
                    transform: translate3d(0, 0, 0) rotate(0);
                }
                25% {
                    transform: translate3d(0, 0, 0) rotate(0);
                }
                50% {
                    transform: translate3d(3px, -2px, 0) rotate(8deg);
                }
                75% {
                    transform: translate3d(0, 0, 0) rotate(0);
                }
                100% {
                    transform: translate3d(0, 0, 0) rotate(0);
                }
            }

            @keyframes scaleStars {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                }
            }

            @keyframes bounce {
                0% {
                    transform: translateY(0);
                }
                25% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(0);
                }
                75% {
                    transform: translateY(-1px);
                }
                100% {
                    transform: translateY(0);
                }
            }

            @keyframes colorChange {
                0% {
                    fill: #ff4500;
                }
                25% {
                    fill: #ffd700;
                }
                50% {
                    fill: #00ff00;
                }
                75% {
                    fill: #1e90ff;
                }
                100% {
                    fill: #ff4500;
                }
            }

            .back-arrow {
                position: relative;
                top: 3px;
                border: 0;
                height: 20px;
                width: 20px;
                margin-left: 5px;

            }

            .legals-disclaimer {
                position: fixed;
                bottom: 10px;
                left: 0;
                right: 0;
                text-align: center;
                z-index: 1000;
                background-color: rgba(248, 250, 252, 0.9);
                padding: 5px 10px;
                border-radius: 4px;
                backdrop-filter: blur(5px);
                color: #333333;
                margin: 0 auto;
                display: none;
            }

            .dialog-buttons {
                display: flex;
                justify-content: flex-end;
                gap: 0.75rem;
                margin-top: 1rem;
            }

            .dialog-button {
                padding: 0.5rem 1rem;
                border-radius: 0.52rem;
                border: none;
                cursor: pointer;
                font-size: 0.875rem;
                transition: background-color 0.2s ease;
            }

            .dialog-button.cancel {
                background-color: #f1f5f9;
                color: #64748b;
            }

            .dialog-button.cancel:hover {
                background-color: #e2e8f0;
            }

            .dialog-button.confirm {
                background-color: var(--primary-color);
                color: white;
            }

            .dialog-button.confirm:hover {
                background-color: var(--secondary-color);
            }

            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.32);
                display: none;
                z-index: 1050;
            }
            /* From Uiverse.io by adamgiebl */
            .cssbuttons-io-button {
                margin-left: 5px;
                background: var(--primary-color);
                color: white;
                font-family: inherit;
                padding: 0.5em 0.25em 0.45em 15px;
                font-size: 17px;
                font-weight: 500;
                border-radius: 40px;
                border: none;
                letter-spacing: 0.05em;
                display: flex;
                align-items: center;
                justify-content: flex-start;
                overflow: hidden;
                position: relative;
                height: 40px;
                cursor: pointer;
                margin-left: 10px;
                white-space: nowrap;
            }

            .cssbuttons-io-button .icon {
                background: white;
                margin-left: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 32px;
                width: 2em;
                border-radius: 40px;
                transition: all 0.3s;
            }

            .cssbuttons-io-button .icon svg {
                width: 1.1em;
                transition: transform 0.3s;
                color: var(--secondary-color);
            }

            .cssbuttons-io-button:hover .icon {
                transform: scale(0.90);
            }

            .cssbuttons-io-button:active .icon {
                transform: scale(0.90);
            }

            .download-options-popup {
                display: none;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.32);
                z-index: 1200;
                justify-content: center;
                align-items: center;
            }

            .download-options-popup-content {
                background-color: white;
                position: fixed;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%);
                border-radius: 28px;
                box-shadow: 0 24px 38px 3px rgba(0,0,0,0.14), 0 9px 46px 8px rgba(0,0,0,0.12), 0 11px 15px -7px rgba(0,0,0,0.2);
                width: 100%;
                max-width: 400px;
                padding: 24px;
            }

            .popup-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .popup-header h2 {
                color: var(--text-color);
                font-size: 1.375rem;
                font-weight: 600;
                margin: 0;
            }

            .close-button {
                background: transparent;
                border: none;
                padding: 8px;
                cursor: pointer;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background-color 0.2s;
            }

            .close-button:hover {
                background-color: rgba(0, 0, 0, 0.04);
            }

            .close-button svg {
                fill: var(--text-color);
            }

            .download-options {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .format-selector {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .format-selector label {
                color: var(--text-color);
                font-size: 0.875rem;
                font-weight: 500;
            }

            .material-dropdown {
                width: 100%;
                padding: 12px 16px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                background-color: white;
                color: var(--text-color);
                font-size: 1rem;
                cursor: pointer;
                transition: border-color 0.2s, box-shadow 0.2s;
                appearance: none;
                background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M7%2010l5%205%205-5z%22%2F%3E%3C%2Fsvg%3E");
                background-repeat: no-repeat;
                background-position: right 12px center;
            }

            .material-dropdown:hover {
                border-color: var(--text-color);
            }

            .material-dropdown:focus {
                outline: none;
            }

            .download-button {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                padding: 12px 24px;
                border: none;
                border-radius: 24px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color 0.2s, box-shadow 0.2s;
            }

            .download-button {
                background-color: var(--primary-color);
                color: white;
                font-size: 1rem;
            }

            .download-button:hover {
                background-color: var(--secondary-color);
                box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            }

            .download-button svg,
            .share-button svg {
                width: 20px;
                height: 20px;
            }

            .download-button svg {
                fill: white;
            }

            .divider {
                height: 1px;
                background-color: var(--border-color);
                margin: 8px 0;
            }

            @media (max-width: 480px) {
                .download-options-popup-content {
                    margin: 16px;
                    padding: 16px;
                }
            }

            h2 {
                margin: 0;
                color: var(--text-color);
                font-size: 24px;
            }

            .share-dialog {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 1.5rem;
                border-radius: 0.5rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                width: 90%;
                max-width: 400px;
                z-index: 1100;
            }

            .share-dialog h3 {
                font-size: 1.5rem;
                margin-top: 0;
                margin-bottom: 0;
            }

            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid var(--primary-color);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 20px auto;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .share-dialog p {
                text-align: left;
                margin: 10px 0;
                color: var(--text-color);
            }

            .share-link {
                width: 96%;
                padding: 0.5rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.375rem;
                font-size: 1rem;
                margin-top: 1rem;
                background: #f8fafc;
            }

            .share-button img {
                display: block;
                margin: 0;
            }

            .share-button:hover {
                background-color: var(--background-color) !important;
            }

            .button-container {
                position: fixed;
                top: 60px;
                right: 15px;
                z-index: 1000;
                background: white;
                border: none;
                border-radius: 12px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                padding: 10px;
                display: none;
                flex-direction: column;
                gap: 10px;
            }

            @media (max-width: 800px) {
                .button-container {
                    top: 50px !important;
                    right: 0 !important;
                    border-radius: 0 0 0 12px;
                }
            }

            .download-mindmap-btn,
            .edit-mode-button,
            .regenerate-button,
            .share-button {
                position: static;
                margin: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 40px;
                width: 40px;
                padding: 10px;
                background: white;
                border-radius: 10px;
                border: none;
                cursor: pointer;
                box-shadow: none;
            }

            .download-mindmap-btn:hover,
            .edit-mode-button:hover,
            .regenerate-button:hover,
            .share-button:hover {
                background-color: var(--background-color) !important;
            }

            .regenerate-button svg {
                margin-bottom: 3px !important;
            }

            .regenerate-button:hover {
                background: var(--background-color);
            }

            .regenerate-button.rotating svg {
                animation: spin 1s linear infinite;
                color: var(--text-color);
            }

            .download-icon {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                margin-bottom: 0;
                margin-right: 0;
            }

            .edit-mode-button:hover {
                background: #f5f5f5;
            }

            .download-mindmap-btn:hover {
                background: #f5f5f5;
            }

            .editor-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.32);
                z-index: 1200;
                display: none;
            }
            .markdown-editor {
                display: none;
                position: fixed;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: 800px;
                height: calc(100vh - 160px);
                z-index: 1201;
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                padding: 20px;
            }

            .markdown-editor textarea {
                width: 100%;
                height: calc(100% - 80px);
                border: 1px solid #c9c9c9;
                border-radius: 10px;
                padding: 10px;
                font-family: monospace;
                font-size: 14px;
                resize: none;
                margin-bottom: 10px;
            }

            .markdown-editor textarea:focus {
                outline: none;
            }

            .editor-buttons {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
            }

            .editor-button {
                padding: 8px 16px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.2s;
            }

            .save-button {
                background-color: var(--primary-color);
                color: white;
            }

            .save-button:hover {
                background-color: var(--secondary-color);
            }

            .cancel-button {
                background-color: #e2e8f0;
                color: var(--text-color);
            }

            .cancel-button:hover {
                background-color: #cbd5e1;
            }
            .markdown-disclaimer {
                position: relative;
                margin-top: 8px;
            }

            .recent-mindmaps {
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                margin-top: 100px;
            }

            .recent-mindmaps h2 {
                font-size: 1.5rem;
                margin-bottom: 10px;
                color: var(--text-color);
                position: relative;
            }

            .recent-list {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .recent-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px;
                background-color: #ffffff;
                border-radius: 8px;
                transition: all 0.2s ease;
                cursor: pointer;
                text-decoration: none;
                color: var(--text-color);
            }

            .recent-item:hover {
                background-color: var(--background-color);
                transform: translateY(-1px);
            }

            .recent-item-title {
                font-weight: 500;
                flex-grow: 1;
            }

            .recent-item-time {
                font-size: 0.9em;
                color: #64748b;
                margin-left: 16px;
            }

            .no-recent {
                text-align: center;
                color: #64748b;
                padding: 20px;
            }

            .view-history-link {
                text-decoration: none;
                color: #1e293b;
                display: inline-block;
                margin-top: 10px;
                font-size: 15px;
                border-radius: 10px;
                padding: 5px 10px;
            }

            .view-history-link:hover {
                background-color: rgba(0, 0, 0, 0.032);
                border-radius: 10px;
                padding: 5px 10px;
            }
            .help-link {
                padding: 5px;
                border-radius: 10px;
                background-color: #f0f0f0;
                border: 1px solid #f0f0f0;
                text-decoration: none;
            }

            .help-link:hover {
                border: 1px solid #ddd;
            }
        </style>
    </head>
    <body>

        <div class="popup" id="legalPopup">
            <div class="popup-content">
                <div>
                    <h2>🍪 Cookies</h2>
                    <p>To proceed, you need to agree to our
                        <a href="/terms-of-use.html" style="color: var(--text-color);">Terms of Use</a>
                        and
                        <a
                            href="/privacy-policy.html"
                            onclick="event.preventDefault();"
                            style="color: var(--text-color);">Privacy Policy</a>
                        <br>
                        <div class="whitespace"></div>

                        <strong>Purposes:</strong>
                        <ul class="legal-purposes">
                            <li>Functionality</li>
                            <li>Analytics</li>
                        </ul>
                    </p>
                    <div class="whitespace"></div>
                </div>
                <button onclick="closePopup()" class="decline-terms-button">Decline</button>
                <button onclick="acceptDisclaimer()" class="accept-terms-button">Accept and Continue</button>

            </div>

        </div>

        <div class="navbar">
            <div class="text-logo">
                <a href="/" class="logo-link">
                    <img src="/img/favicon96.png" alt="Logo" class="logo">
                    <h3 class="logo-text" id="logo-text">
                        Mind Map Wizard
                    </h3>
                </a>
            </div>

            <div class="nav-links">
                <a href="/history.html"><img src="/img/icons/history-icon.svg" height="22" width="22">
                    History</a>

                <button class="cssbuttons-io-button" onclick="window.location.href='/new.html'">
                    New Mind Map
                    <div class="icon">
                        <svg
                            height="24"
                            width="24"
                            viewbox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path
                                d="M12 2C11.4477 2 11 2.44772 11 3V11H3C2.44772 11 2 11.4477 2 12C2 12.5523 2.44772 13 3 13H11V21C11 21.5523 11.4477 22 12 22C12.5523 22 13 21.5523 13 21V13H21C21.5523 13 22 12.5523 22 12C22 11.4477 21.5523 11 21 11H13V3C13 2.44772 12.5523 2 12 2Z"
                                fill="currentColor"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                    </div>
                </button>

            </div>
        </div>
    </div>
    <p id="back-button" class="back-button" style="font-size: 20px;">
        <a href="/" style="text-decoration: none; color: #1e293b;">
            <img src="/img/icons/arrow-back-black.svg" alt="Back" class="back-arrow">
            Back
        </a>

    </p>

</p>
<div id="app">

    <div class="loading-animation" id="loading-animation">
        <div class="analyze">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewbox="0 0 24 24"
                height="54"
                width="54">
                <rect height="45" width="45"></rect>
                <path
                    stroke-linecap="round"
                    stroke-width="1.5"
                    stroke="var(--primary-color)"
                    d="M19.25 9.25V5.25C19.25 4.42157 18.5784 3.75 17.75 3.75H6.25C5.42157 3.75 4.75 4.42157 4.75 5.25V18.75C4.75 19.5784 5.42157 20.25 6.25 20.25H12.25"
                    class="board"></path>
                <path
                    d="M9.18748 11.5066C9.12305 11.3324 8.87677 11.3324 8.81234 11.5066L8.49165 12.3732C8.47139 12.428 8.42823 12.4711 8.37348 12.4914L7.50681 12.8121C7.33269 12.8765 7.33269 13.1228 7.50681 13.1872L8.37348 13.5079C8.42823 13.5282 8.47139 13.5714 8.49165 13.6261L8.81234 14.4928C8.87677 14.6669 9.12305 14.6669 9.18748 14.4928L9.50818 13.6261C9.52844 13.5714 9.5716 13.5282 9.62634 13.5079L10.493 13.1872C10.6671 13.1228 10.6671 12.8765 10.493 12.8121L9.62634 12.4914C9.5716 12.4711 9.52844 12.428 9.50818 12.3732L9.18748 11.5066Z"
                    class="star-2"></path>
                <path
                    d="M11.7345 6.63394C11.654 6.41629 11.3461 6.41629 11.2656 6.63394L10.8647 7.71728C10.8394 7.78571 10.7855 7.83966 10.717 7.86498L9.6337 8.26585C9.41605 8.34639 9.41605 8.65424 9.6337 8.73478L10.717 9.13565C10.7855 9.16097 10.8394 9.21493 10.8647 9.28335L11.2656 10.3667C11.3461 10.5843 11.654 10.5843 11.7345 10.3667L12.1354 9.28335C12.1607 9.21493 12.2147 9.16097 12.2831 9.13565L13.3664 8.73478C13.5841 8.65424 13.5841 8.34639 13.3664 8.26585L12.2831 7.86498C12.2147 7.83966 12.1607 7.78571 12.1354 7.71728L11.7345 6.63394Z"
                    class="star-1"></path>
                <path
                    class="stick"
                    stroke-linejoin="round"
                    stroke-width="1.5"
                    stroke="var(--secondary-color)"
                    d="M17 14L21.2929 18.2929C21.6834 18.6834 21.6834 19.3166 21.2929 19.7071L20.7071 20.2929C20.3166 20.6834 19.6834 20.6834 19.2929 20.2929L15 16M17 14L15.7071 12.7071C15.3166 12.3166 14.6834 12.3166 14.2929 12.7071L13.7071 13.2929C13.3166 13.6834 13.3166 14.3166 13.7071 14.7071L15 16M17 14L15 16"></path>
            </svg>
        </div>
        <br>
        <small>Generating Mind Map...</small>
    </div>

    <div class="centered-div">

        <div class="header" id="header">
            <div class="whitespace" style="height: 100px;"></div>

            <h1>Generate a Mind Map with AI</h1>
            <div class="input-wrapper">
                <input
                    type="text"
                    name="text"
                    class="input"
                    id="prompt"
                    placeholder="Your mind map topic..."/>
                <button id="generate-mindmap-btn" class="send-prompt-btn">
                    <img
                        src="/img/icons/send-icon.png"
                        alt="Generate"
                        height="26px"
                        width="26px"
                        class="send-icon">
                </button>
            </div>
        </div>

        <small class="legals-disclaimer" id="legals-disclaimer">By sending a topic on Mind Map Wizard, you agree to our
            <a href="/terms-of-use.html" style="color: var(--text-color)">Terms of use</a>
            and have read our
            <a href="/privacy-policy.html" style="color: var(--text-color)">Privacy Policy</a>
        </small>

        <div id="recent-mindmaps-container">
            <div class="recent-mindmaps" id="recent-mindmaps">
                <h2><img
                    src="/img/icons/history-icon.svg"
                    height="28"
                    width="28"
                    style="margin-bottom: -5px; margin-right: 5px;">Recent Mind Maps</h2>
                <small></small>
                <div class="recent-list" id="recent-list">
                    <!-- Items will be added here dynamically -->
                </div>
                <div style="text-align: right; margin-bottom: 10px;">
                    <a href="/history.html" class="view-history-link">
                        View history
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="6"
                            height="11"
                            viewbox="0 0 6 11"
                            style="margin-left: 3px;">
                            <polyline
                                points=".675 .925 5.323 5.5 .675 10.075"
                                fill="none"
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="1.5"></polyline>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="mindmap"></div>
<small class="ai-content-disclaimer" id="ai-content-disclaimer">AI Content may display inaccurate or offensive information - Pro AI</small>

<div id="download-options-popup" class="download-options-popup">
    <div class="download-options-popup-content">
        <div class="popup-header">
            <h2>Download Mind Map</h2>
            <button class="close-button" id="close-download-options-popup">
                <svg width="24" height="24" viewbox="0 0 24 24"><path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
        </div>
        <div class="download-options">
            <div class="format-selector">
                <label for="download-format">File format</label>
                <select id="download-format" class="material-dropdown">
                    <option value="jpg">JPG - Image</option>
                    <option value="svg">SVG - Vector Graphics</option>
                    <option value="pdf">PDF - Document</option>
                    <option value="markdown">Markdown - Text</option>
                </select>
            </div>
            <button class="download-button primary" id="download-btn">
                Download
            </button>
        </div>
    </div>
</div>

<div class="button-container" id="button-container">
    <button
        class="share-button"
        id="share-btn"
        onclick="shareMindmap()"
        title="Share">
        <img src="/img/icons/share-icon-black.svg" alt="Share" width="25" height="25">
    </button>
    <button class="edit-mode-button" id="edit-mode-button" title="Edit">
        <img src="/img/icons/edit-icon.svg" alt="Edit" width="25" height="25">
    </button>
    <button class="download-mindmap-btn" id="download-mindmap-btn" title="Download">
        <img src="/img/icons/download-icon.png" alt="Download" width="28" height="28">
    </button>
    <button class="regenerate-button" id="regenerate-button" title="Regenerate">
        <img src="/img/icons/retry-icon.svg" alt="Regenerate" width="25" height="25">
    </button>

</div>

<div class="editor-overlay" id="editor-overlay"></div>
<div class="markdown-editor" id="markdown-editor">
    <textarea id="markdown-textarea" spellcheck="false"></textarea>
    <div class="editor-buttons">
        <a
            href="/help/mind-map-editing.html"
            class="help-button"
            style="position: fixed; bottom: 10px; left: 10px; width: 30px; height: 30px; background: #C667FF; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">?</a>

        <button class="editor-button cancel-button" id="cancel-edit">Cancel</button>
        <button class="editor-button save-button" id="save-edit">Save</button>
    </div>
</div>

<div class="info-button">
    <img src="/img/icons/info-icon.svg" alt="Info" width="22" height="22">
</div>
<div class="info-menu">
    <a href="/feedback.html">Feedback</a>
    <a href="/privacy-policy.html">Privacy Policy</a>
    <a href="/terms-of-use.html">Terms of Use</a>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document
            .getElementById('prompt')
            .focus();
    });
    let currentMarkdown = '';
    let currentMindmap = {
        topic: '',
        markdown: '',
        timestamp: null
    };

    function updateCurrentMindmap() {
        const topic = document
            .getElementById('logo-text')
            .textContent;
        const markdown = document
            .getElementById('mindmap')
            .getAttribute('data-markdown') || '';
        currentMindmap = {
            topic: topic,
            markdown: markdown,
            timestamp: new Date().toISOString()
        };
    }

    function closeShareDialog() {
        const overlay = document.querySelector('.overlay');
        const dialog = document.querySelector('.share-dialog');
        if (overlay) 
            overlay.remove();
        if (dialog) 
            dialog.remove();
        }
    
    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0,
                v = c == 'x'
                    ? r
                    : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    async function shareMindmap() {
        const shareButton = document.querySelector('.share-button');
        if (shareButton) {
            shareButton.disabled = true;
            shareButton.style.opacity = '0.5';
        }

        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        overlay.style.display = 'block';

        const dialog = document.createElement('div');
        dialog.className = 'share-dialog';
        dialog.innerHTML = `
            <h3>Share Mindmap</h3>
            <p>Generating share link...</p>
            <div class="loading-spinner"></div>
        `;

        document
            .body
            .appendChild(overlay);
        document
            .body
            .appendChild(dialog);

        try {
            updateCurrentMindmap();
            if (!currentMindmap.markdown) {
                throw new Error('No mind map content available to share');
            }
            const response = await fetch('https://api.mindmapwizard.com/share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(
                    {topic: currentMindmap.topic, markdown: currentMindmap.markdown, timestamp: new Date().toISOString()}
                )
            });

            const data = await response.json();

            if (window.dataLayer) {
                window
                    .dataLayer
                    .push({'event': 'mindmap_share_success', 'action': 'Share Success'});
            }

            const shareUrl = `${window.location.origin}/view.html?id=${data.id}`;

            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.style.display = 'block';

            const dialog = document.createElement('div');
            dialog.className = 'share-dialog';
            dialog.innerHTML = `
                <h3>Share Mindmap</h3>
                <p>Copy this link to share your mindmap:</p>
                <input type="text" class="share-link" value="${shareUrl}" readonly>
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" onclick="closeShareDialog()">Close</button>
                    <button class="dialog-button confirm" onclick="copyShareLink()">Copy Link</button>
                </div>
            `;

            document
                .body
                .appendChild(overlay);
            document
                .body
                .appendChild(dialog);

        } catch (error) {
            console.error('Error sharing mindmap:', error);
            dialog.innerHTML = `
                <h3>Share Mindmap</h3>
                <p style="color: red;">Failed to share mindmap. Please try again.</p>
                <div class="dialog-buttons">
                    <button class="dialog-button cancel" onclick="closeShareDialog()">Close</button>
                </div>
            `;

            if (window.dataLayer) {
                window
                    .dataLayer
                    .push({'event': 'mindmap_share_error', 'action': 'Share Failed'});
            }
        } finally {
            if (shareButton) {
                shareButton.disabled = false;
                shareButton.style.opacity = '1';
            }
        }
    }

    function copyShareLink() {
        const shareLink = document.querySelector('.share-link');
        shareLink.select();
        document.execCommand('copy');

        if (window.dataLayer) {
            window
                .dataLayer
                .push(
                    {'event': 'mindmap_share_link_copy', 'mindmap_category': 'User Interaction', 'mindmap_action': 'Copy Share Link'}
                );
        }
    }

    function formatMarkdown(text) {
        const topicMatch = text.match(/topic="([^"]+)"/);
        const markdownMatch = text.match(/markdown="([^"]+)"/);

        if (!topicMatch || !markdownMatch) {
            console.error("Invalid response format");
            return {topic: null, markdown: null};
        }

        const topic = topicMatch[1];
        let markdown = markdownMatch[1];

        markdown = markdown
            .replace(/\\n/g, '\n')
            .trim()
            .replace(/\n\s*\n/g, '\n\n')
            .replace(/```/g, '');

        return {topic, markdown};
    }

    function generateMindmap(mindmapTopic, isRegenerate = false) {
        if (!mindmapTopic) 
            return;

        if (!isRegenerate) {
            document
                .getElementById("header")
                .style
                .display = "none";
            document
                .getElementById("recent-mindmaps")
                .style
                .display = "none";

            document
                .getElementById("back-button")
                .style
                .display = "block";
            document
                .getElementById("ai-content-disclaimer")
                .style
                .display = "block";
            document
                .getElementById("mindmap")
                .style
                .display = "none";
        }

        document
            .getElementById("loading-animation")
            .style
            .display = "flex";

        if (isRegenerate) {
            const regenerateBtn = document.getElementById('regenerate-button');
            regenerateBtn
                .classList
                .add('rotating');
        }

        document
            .getElementById("logo-text")
            .textContent = mindmapTopic;

        document
            .getElementById("mindmap")
            .style
            .display = "block";

        fetch('https://generate.mindmapwizard.com', {
            method: 'POST',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(
                {input: mindmapTopic}
            )
        })
            .then(response => response.json())
            .then(data => {
                const {topic, markdown} = formatMarkdown(data.response);
                if (markdown) {
                    let xhr = new XMLHttpRequest();
                    xhr.open(
                        "GET",
                        "https://abacus.jasoncameron.dev/hit/mindmapwizard.com/mind-map-generated"
                    );
                    xhr.send();
                    renderMindmap(markdown);
                    if (!isRegenerate) {
                        saveMindmapToHistory(topic || mindmapTopic, markdown);
                    } else {
                        saveMindmapToHistory(topic || mindmapTopic, markdown);
                    }
                    document
                        .getElementById("logo-text")
                        .textContent = topic || mindmapTopic;

                    if (window.dataLayer) {
                        window
                            .dataLayer
                            .push({
                                'event': 'mindmap_generated',
                                'mindmap_type': isRegenerate
                                    ? 'regenerated'
                                    : 'new'
                            });
                    }
                }
                document
                    .getElementById("loading-animation")
                    .style
                    .display = "none";

                document
                    .getElementById("button-container")
                    .style
                    .display = "flex";

                if (isRegenerate) {
                    const regenerateBtn = document.getElementById('regenerate-button');
                    regenerateBtn
                        .classList
                        .remove('rotating');
                }
            })
            .catch(error => {
                console.error("Error generating the mindmap:", error);
                document
                    .getElementById("loading-animation")
                    .style
                    .display = "none";
                if (isRegenerate) {
                    const regenerateBtn = document.getElementById('regenerate-button');
                    regenerateBtn
                        .classList
                        .remove('rotating');
                }
                alert("Error generating mindmap. Please try again.");
            });
    }

    function renderMindmap(markdown) {
        currentMarkdown = markdown;
        const mindmapContainer = document.getElementById('mindmap');
        mindmapContainer.setAttribute('data-markdown', markdown);
        mindmapContainer.innerHTML = "";
        try {
            if (!markdown || typeof markdown !== 'string') {
                throw new Error("Invalid markdown input");
            }

            if (!markdown.trim().startsWith('#')) {
                markdown = '# ' + markdown;
            }

            mindmapContainer.style.position = 'fixed';
            mindmapContainer.style.top = '0';
            mindmapContainer.style.left = '0';
            mindmapContainer.style.width = '100vw';
            mindmapContainer.style.height = '100vh';
            mindmapContainer.style.display = 'block';

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            mindmapContainer.appendChild(svg);

            const {Markmap, Transformer} = window.markmap;
            const transformer = new Transformer();
            const {root} = transformer.transform(markdown);

            const mm = Markmap.create(svg, {
                autoFit: true,
                duration: 500,
                maxWidth: 300,
                zoom: true,
                pan: true
            }, root);

            mm.fit();

        } catch (error) {
            console.error('Mindmap Error:', error);
            const errorMessage = document.createElement('div');
            errorMessage.textContent = "Error rendering the mindmap: " + error.message;
            errorMessage.style.color = 'var(--error-color)';
            mindmapContainer.appendChild(errorMessage);
        }
    }
    const DownloadHandler = {
        getMindmapElements() {
            const container = document.getElementById('mindmap');
            const svg = container
                ?.querySelector('svg');
            const topic = document.getElementById('logo-text')
                ?.textContent || 'mindmap';

            if (!svg || container.children.length === 0) {
                throw new Error("No mind map available to download.");
            }

            return {svg, topic};
        },

        getSVGData(svg, padding = 30) {
            const bbox = svg.getBBox();
            const width = bbox.width + (padding * 2);
            const height = bbox.height + (padding * 2);

            const svgCopy = svg.cloneNode(true);
            svgCopy.setAttribute('width', width);
            svgCopy.setAttribute('height', height);
            svgCopy.setAttribute(
                'viewBox',
                `${bbox.x - padding} ${bbox.y - padding} ${width} ${height}`
            );

            const svgContent = new XMLSerializer().serializeToString(svgCopy);

            return {svgContent, width, height};
        },

        triggerDownload(blob, filename) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document
                .body
                .appendChild(link);
            link.click();
            document
                .body
                .removeChild(link);
            URL.revokeObjectURL(url);
        },

        downloadMarkdown(topic) {
            const blob = new Blob([currentMarkdown], {type: 'text/markdown'});
            this.triggerDownload(blob, `${topic}.md`);
        },

        downloadSVG(svgContent, topic) {
            const blob = new Blob([svgContent], {type: "image/svg+xml;charset=utf-8"});
            this.triggerDownload(blob, `${topic}.svg`);
        },

        downloadPDF(svgContent, width, height, topic) {
            const tempSvg = document.createElement('div');
            tempSvg.innerHTML = svgContent;
            const svgElement = tempSvg.firstElementChild;
            const svgData = new XMLSerializer().serializeToString(svgElement);

            const scale = 1.8;
            const canvas = document.createElement('canvas');
            canvas.width = width * scale;
            canvas.height = height * scale;
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin = 'Anonymous';

            img.onload = () => {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.scale(scale, scale);
                ctx.drawImage(img, 0, 0);

                const pdf = new jsPDF({
                    orientation: width > height
                        ? 'landscape'
                        : 'portrait',
                    unit: 'pt',
                    format: 'letter'
                });

                const pdfWidth = pdf
                    .internal
                    .pageSize
                    .getWidth();
                const pdfHeight = pdf
                    .internal
                    .pageSize
                    .getHeight();

                const pdfAspectRatio = pdfWidth / pdfHeight;
                const imageAspectRatio = width / height;
                let finalWidth = pdfWidth;
                let finalHeight = pdfHeight;

                if (imageAspectRatio > pdfAspectRatio) {
                    finalHeight = pdfWidth / imageAspectRatio;
                } else {
                    finalWidth = pdfHeight * imageAspectRatio;
                }

                const xOffset = (pdfWidth - finalWidth) / 2;
                const yOffset = (pdfHeight - finalHeight) / 2;

                pdf.addImage(
                    canvas.toDataURL('image/jpeg', 1.0),
                    'JPEG',
                    xOffset,
                    yOffset,
                    finalWidth,
                    finalHeight
                );

                pdf.save(`${topic}.pdf`);
                canvas.remove();
            };

            img.src = 'data:image/svg+xml;base64,' + btoa(
                unescape(encodeURIComponent(svgData))
            );
        },

        downloadJPG(svg, topic) {
            const {svgContent, width, height} = this.getSVGData(svg);
            const tempSvg = document.createElement('div');
            tempSvg.innerHTML = svgContent;
            const svgElement = tempSvg.firstElementChild;
            const svgData = new XMLSerializer().serializeToString(svgElement);

            const scale = 2.0;
            const canvas = document.createElement('canvas');
            canvas.width = width * scale;
            canvas.height = height * scale;
            const ctx = canvas.getContext('2d');

            const img = new Image();
            img.crossOrigin = 'Anonymous';

            img.onload = () => {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.scale(scale, scale);
                ctx.drawImage(img, 0, 0);
                this.triggerDownload(
                    this.dataURLToBlob(canvas.toDataURL('image/jpeg', 1.0)),
                    `${topic}.jpg`
                );
                canvas.remove();
            };

            img.src = 'data:image/svg+xml;base64,' + btoa(
                unescape(encodeURIComponent(svgData))
            );
        },

        dataURLToBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type: mime});
        }
    };

    window.jsPDF = window.jspdf.jsPDF;

    function downloadMindmap(format) {
        try {
            const {svg, topic} = DownloadHandler.getMindmapElements();

            if (format === 'markdown') {
                DownloadHandler.downloadMarkdown(topic);
                return;
            }

            const {svgContent, width, height} = DownloadHandler.getSVGData(svg);

            switch (format) {
                case 'svg':
                    DownloadHandler.downloadSVG(svgContent, topic);
                    break;
                case 'pdf':
                    DownloadHandler.downloadPDF(svgContent, width, height, topic);
                    break;
                case 'jpg':
                    DownloadHandler.downloadJPG(svg, topic);
                    break;
                default:
                    throw new Error(`Unsupported format: ${format}`);
            }

            document
                .getElementById('download-options-popup')
                .style
                .display = 'none';
        } catch (error) {
            console.error('Download error:', error);
            alert(error.message);
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const downloadBtn = document.getElementById('download-btn');
        const formatSelect = document.getElementById('download-format');

        downloadBtn.addEventListener('click', function () {
            const format = formatSelect.value;
            downloadMindmap(format);
        });
    });

    function downloadAsImage() {
        try {
            const {svg, topic} = DownloadHandler.getMindmapElements();
            DownloadHandler.downloadJPG(svg, topic);
        } catch (error) {
            console.error('Download error:', error);
            alert(error.message);
        }
    }
    const downloadBtn = document.getElementById('download-mindmap-btn');
    const popup = document.getElementById('download-options-popup');
    const closeBtn = document.getElementById('close-download-options-popup');
    const prompt = document.getElementById('prompt');
    const regenerateBtn = document.getElementById('regenerate-button');
    const generateBtn = document.getElementById('generate-mindmap-btn');
    const editModeButton = document.getElementById('edit-mode-button');
    const cancelEditButton = document.getElementById('cancel-edit');
    const saveEditButton = document.getElementById('save-edit');
    loadRecentMindmaps();

    editModeButton.addEventListener('click', () => toggleEditMode(true));
    cancelEditButton.addEventListener('click', () => toggleEditMode(false));
    saveEditButton.addEventListener('click', updateMindmapFromEdit);

    generateBtn.addEventListener('click', function () {
        const mindmapTopic = prompt
            .value
            .trim();
        if (mindmapTopic) {
            generateMindmap(mindmapTopic);
        }
    });

    regenerateBtn.addEventListener('click', function () {
        console.log('Regenerate-Button clicked!');

        const currentTopic = document
            .getElementById("logo-text")
            .textContent;
        if (!currentTopic) {
            console.error("No topic available to regenerate the mindmap.");
            return;
        }

        generateMindmap(currentTopic, true);
    });

    downloadBtn.addEventListener('click', function () {
        popup.style.display = 'block';
    });

    closeBtn.addEventListener('click', function () {
        popup.style.display = 'none';
    });

    popup.addEventListener('click', function (event) {
        if (event.target === popup) {
            popup.style.display = 'none';
        }
    });

    const mindmapTopic = getQueryParameter('q');
    if (mindmapTopic) {
        generateMindmap(mindmapTopic);
    }

    document.addEventListener('DOMContentLoaded', function () {
        document
            .getElementById('prompt')
            .focus();
    });

    document
        .getElementById('download-mindmap-btn')
        .onclick = function () {
            document
                .getElementById('download-options-popup')
                .style
                .display = 'block';
        }

    document
        .getElementById('download-options-popup')
        .onclick = function (event) {
            if (event.target === this) {
                document
                    .getElementById('download-options-popup')
                    .style
                    .display = 'none';
            }
        }

    document
        .getElementById('close-download-options-popup')
        .onclick = function () {
            document
                .getElementById('download-options-popup')
                .style
                .display = 'none';
        }

    window.onclick = function (event) {
        const popup = document.getElementById('download-options-popup');
        if (event.target === popup) {
            popup.style.display = 'none';
        }
    }

    function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return decodeURIComponent(urlParams.get(name) || '');
    }

    prompt.addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
            const mindmapTopic = prompt
                .value
                .trim();
            if (mindmapTopic) {
                generateMindmap(mindmapTopic);
            }
        }

        const mindmapTopic = getQueryParameter('q');
        if (mindmapTopic) {
            generateMindmap(mindmapTopic);
        }
    });

    function saveMindmapToHistory(topic, markdown) {
        const history = JSON.parse(localStorage.getItem('mindmap-history') || '[]');
        const timestamp = new Date().toISOString();

        history.push({topic, markdown, timestamp, id: Date.now()});

        if (history.length > 100) {
            history.shift();
        }

        localStorage.setItem('mindmap-history', JSON.stringify(history));
    }

    document
        .getElementById('download-mindmap-btn')
        .onclick = function () {
            document
                .getElementById('download-options-popup')
                .style
                .display = 'block';
        }
    document
        .getElementById('download-options-popup')
        .onclick = function (event) {
            if (event.target === this) {
                document
                    .getElementById('download-options-popup')
                    .style
                    .display = 'none';
            }
        }

    document
        .getElementById('close-download-options-popup')
        .onclick = function () {
            document
                .getElementById('download-options-popup')
                .style
                .display = 'none';
        }

    window.onclick = function (event) {
        const popup = document.getElementById('download-options-popup');
        if (event.target === popup) {
            popup.style.display = 'none';
        }
    }

    function downloadAsImage() {
        const mindmapContainer = document.getElementById('mindmap');
        const svg = mindmapContainer.querySelector('svg');

        if (!svg) {
            alert("No mind map available to export.");
            return;
        }

        const svgCopy = svg.cloneNode(true);

        const bbox = svg.getBBox();
        const padding = 20;

        const width = bbox.width + (padding * 2);
        const height = bbox.height + (padding * 2);

        svgCopy.setAttribute(
            'viewBox',
            `${bbox.x - padding} ${bbox.y - padding} ${width} ${height}`
        );
        svgCopy.setAttribute('width', width);
        svgCopy.setAttribute('height', height);

        const serializer = new XMLSerializer();
        const svgStr = serializer.serializeToString(svgCopy);
        const svgBase64 = btoa(unescape(encodeURIComponent(svgStr)));
        const dataUrl = `data:image/svg+xml;base64,${svgBase64}`;

        const img = new Image();
        img.crossOrigin = 'Anonymous';
        img.onload = function () {
            const scale = 1.8;
            const canvas = document.createElement('canvas');
            canvas.width = this.width * scale;
            canvas.height = this.height * scale;

            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.scale(scale, scale);
            ctx.drawImage(img, 0, 0);

            const url = canvas.toDataURL('image/png', 1.0);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mindmap.png';
            a.click();
        };

        img.src = dataUrl;
        document
            .getElementById('download-options-popup')
            .style
            .display = 'none';
    }

    function toggleEditMode(show) {
        const mindmapElement = document.getElementById('mindmap');
        const editorElement = document.getElementById('markdown-editor');
        const textarea = document.getElementById('markdown-textarea');
        const editorOverlay = document.getElementById('editor-overlay');

        if (show) {
            mindmapElement.style.display = 'none';
            editorElement.style.display = 'block';
            editorOverlay.style.display = 'block';
            textarea.value = currentMarkdown;
            textarea.focus();
        } else {
            mindmapElement.style.display = 'block';
            editorElement.style.display = 'none';
            editorOverlay.style.display = 'none';
        }
    }

    function updateMindmapFromEdit() {
        const textarea = document.getElementById('markdown-textarea');
        const newMarkdown = textarea.value;

        if (newMarkdown !== currentMarkdown) {
            currentMarkdown = newMarkdown;
            renderMindmap(currentMarkdown);

            const topic = document
                .getElementById('logo-text')
                .textContent;
            const history = JSON.parse(localStorage.getItem('mindmap-history') || '[]');
            const currentItem = history.find(item => item.topic === topic);

            if (currentItem) {
                currentItem.markdown = currentMarkdown;
                localStorage.setItem('mindmap-history', JSON.stringify(history));
            }
        }

        toggleEditMode(false);
    }
    function loadRecentMindmaps() {
        const recentList = document.getElementById('recent-list');
        const history = JSON.parse(localStorage.getItem('mindmap-history') || '[]');

        if (history.length === 0) {
            recentList.innerHTML = '<div class="no-recent">No recent mind maps</div>';
            document
                .getElementById('recent-mindmaps-container')
                .style
                .display = 'none';
            return;
        }

        const sortedHistory = history.sort(
            (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
        );

        const recentItems = sortedHistory.slice(0, 3);

        recentList.innerHTML = recentItems
            .map(item => {
                const date = new Date(item.timestamp);
                const timeAgo = getTimeAgo(date);

                return `
            <a href="/history.html?id=${item.id}" class="recent-item">
                <span class="recent-item-title">${item.topic}</span>
                <span class="recent-item-time">${timeAgo}</span>
            </a>
        `;
            })
            .join('');
    }

    function getTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);

        const intervals = {
            year: 31536000,
            month: 2592000,
            week: 604800,
            day: 86400,
            hour: 3600,
            minute: 60
        };

        for (const [unit, secondsInUnit] of Object.entries(intervals)) {
            const interval = Math.floor(seconds / secondsInUnit);

            if (interval >= 1) {
                return interval === 1
                    ? `1 ${unit} ago`
                    : `${interval} ${unit}s ago`;
            }
        }
        return 'Just now';
    }

    async function shareMindmap() {
        const shareButton = document.querySelector('.share-button');
        if (shareButton) {
            shareButton.disabled = true;
            shareButton.style.opacity = '0.5';
        }

        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        overlay.style.display = 'block';

        const dialog = document.createElement('div');
        dialog.className = 'share-dialog';
        dialog.innerHTML = `
        <h3>Share Mindmap</h3>
        <p>Generating share link...</p>
        <div class="loading-spinner"></div>
    `;

        document
            .body
            .appendChild(overlay);
        document
            .body
            .appendChild(dialog);

        try {
            updateCurrentMindmap();
            if (!currentMindmap.markdown) {
                throw new Error('No mind map content available to share');
            }
            const response = await fetch('https://api.mindmapwizard.com/share', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(
                    {topic: currentMindmap.topic, markdown: currentMindmap.markdown, timestamp: new Date().toISOString()}
                )
            });

            const data = await response.json();

            if (window.dataLayer) {
                window
                    .dataLayer
                    .push({'event': 'mindmap_share_success', 'action': 'Share Success'});
            }

            const shareUrl = `${window.location.origin}/view.html?id=${data.id}`;

            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.style.display = 'block';

            const dialog = document.createElement('div');
            dialog.className = 'share-dialog';
            dialog.innerHTML = `
            <h3>Share Mindmap</h3>
            <p>Copy this link to share your mindmap:</p>
            <input type="text" class="share-link" value="${shareUrl}" readonly>
            <div class="dialog-buttons">
                <button class="dialog-button cancel" onclick="closeShareDialog()">Close</button>
                <button class="dialog-button confirm" onclick="copyShareLink()">Copy Link</button>
            </div>
        `;

            document
                .body
                .appendChild(overlay);
            document
                .body
                .appendChild(dialog);

        } catch (error) {
            console.error('Error sharing mindmap:', error);
            dialog.innerHTML = `
            <h3>Share Mindmap</h3>
            <p style="color: red;">Failed to share mindmap. Please try again.</p>
            <div class="dialog-buttons">
                <button class="dialog-button cancel" onclick="closeShareDialog()">Close</button>
            </div>
        `;

            if (window.dataLayer) {
                window
                    .dataLayer
                    .push({'event': 'mindmap_share_error', 'action': 'Share Failed'});
            }
        } finally {
            if (shareButton) {
                shareButton.disabled = false;
                shareButton.style.opacity = '1';
            }
        }
    }

    function copyShareLink() {
        const input = document.querySelector('.share-link');
        input.select();
        document.execCommand('copy');
    }

    function closeShareDialog() {
        const dialog = document.querySelector('.share-dialog');
        const overlay = document.querySelector('.overlay');
        if (dialog) 
            dialog.remove();
        if (overlay) 
            overlay.remove();
        }
    
    document
        .querySelector('.info-button')
        .addEventListener('click', function (e) {
            e.preventDefault();
            document
                .querySelector('.info-menu')
                .classList
                .toggle('show');
        });
</script>
</body>
</html>



